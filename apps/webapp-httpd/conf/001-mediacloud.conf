ServerName  api.mediacloud.org
ServerAdmin mediacloud@cyber.law.harvard.edu

<Location />
    Options ExecCGI

    # New form to write "Order allow,deny; Allow from all" in Apache 2.4
    Require all granted

    # Dynamic CORS header: https://stackoverflow.com/a/1850482/200603
    SetEnvIf Origin "http(s)?://.*?(media\.mit\.edu|mediacloud\.org)$" AccessControlAllowOrigin=$0
    Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
    Header merge Vary Origin

</Location>

# Static files served by the webapp
Alias           /static     /mediacloud_webapp_static
<Location /static>
    SetHandler default-handler
</Location>

FastCGIExternalServer   /var/run/mc-webapp.sock -host webapp-api:9090
Alias   /   /var/run/mc-webapp.sock/

RewriteEngine On
RewriteRule ^/login/register    https://tools.mediacloud.org/#/user/signup                  [NE,L,R=301]
RewriteRule ^/login/forgot      https://tools.mediacloud.org/#/user/request-password-reset  [NE,L,R=301]

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\" %D" mc
CustomLog /var/log/apache2/access.log mc
