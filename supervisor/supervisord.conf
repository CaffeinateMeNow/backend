; DO NOT EDIT THIS FILE. THIS FILE IS RECREATED DURING EACH CALL TO supervisord.sh BY APPLYING
; mediawords.yml TO supervisor.cont.tt2.
;
; To edit the individual process properties, please edit "mediawords.yml".
;
; To update how the processes get started, please edit "supervisor/supervisor.conf.tt2".
;
;
; Media Cloud configuration file for Supervisor (http://supervisord.org/)
;
; To add your own services to Supervisor, create
; "supervisord.user.service_name.conf" and add your additional configuration
; properties there.
;


[inet_http_server]
port = 127.0.0.1:8398
username = supervisord
password = qHujfp7n4J

[supervisord]
logfile = %(here)s/../data/supervisor_logs/supervisord.log  ; main log file (default $CWD/supervisord.log)
pidfile = %(here)s/../data/supervisor_logs/supervisord.pid     ; supervisord pidfile (default supervisord.pid)
# DO NOT set "childlogdir" here because it is set by the supervisord.sh script
;childlogdir = %(here)s/../data/supervisor_logs/            ; ('AUTO' child log dir, default $TEMP)
directory = %(here)s/../                                    ; chroot to Media Cloud's root directory
nocleanup = true                                            ; don't remove process logs after stopping the process

; The below section must remain in the config file for RPC (supervisorctl /
; web interface) to work, additional interfaces may be added by defining them
; in separate rpcinterface: sections
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl = unix://%(here)s/supervisord.sock                ; use a unix:// URL for a unix socket



[program:crawler_provider]
command = /usr/bin/nice -n 12 ./script/run_in_env.sh tools/web/crawler-provider.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:crawler_fetcher]
command = /usr/bin/nice -n 12 ./script/run_in_env.sh script/crawler_fetcher.pl
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:crawl_ap]
command = /usr/bin/nice -n 12 ./script/run_in_env.sh tools/web/crawl-ap.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0


; Solr shards take about 5,5 minutes to start (no idea why), so we wait for 7 minutes before starting the import


[program:import_solr_data]
command = /usr/bin/nice -n 12 bash -c 'echo Waiting for Solr to start up... && sleep 420 && ./script/run_in_env.sh ./script/import_solr_data.pl --daemon --jobs 1'
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:scrape_feedly]
command = /usr/bin/nice -n 12 ./script/run_in_env.sh script/scrape_feedly.pl --all
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:create_missing_partitions]
command = /usr/bin/nice -n 12 ./script/run_in_env.sh ./tools/db/create_missing_partitions.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = true
killasgroup = true
priority = 5
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:purge_object_caches]
command = /usr/bin/nice -n 12 ./script/run_in_env.sh ./tools/db/purge_object_caches.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = true
killasgroup = true
priority = 5
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0


; Job brokers
[group:job_broker]
programs = rabbitmq



[program:rabbitmq]
command = /usr/bin/nice -n 10 bash ./script/rabbitmq_wrapper.sh
directory = %(here)s/../
autorestart = true

autostart = false

stopasgroup = true
killasgroup = true
priority = 10
numprocs = 1
stopwaitsecs=60
stopsignal=INT

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:rescrape_media]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh mjm_worker.pl lib/MediaWords/Job/RescrapeMedia.pm
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:extract_and_vector]
command = /usr/bin/nice -n 11 ./script/run_in_env.sh ./mediacloud/mediawords/job/extract_and_vector.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:topic_mine]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh mjm_worker.pl lib/MediaWords/Job/TM/MineTopic.pm
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:topic_mine_public]
command = /usr/bin/nice -n 15 ./script/run_in_env.sh mjm_worker.pl lib/MediaWords/Job/TM/MineTopicPublic.pm
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:topic_snapshot]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh mjm_worker.pl lib/MediaWords/Job/TM/SnapshotTopic.pm
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:cliff_fetch_annotation]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/cliff/fetch_annotation.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:cliff_update_story_tags]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/cliff/update_story_tags.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:nyt_labels_fetch_annotation]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/nyt_labels/fetch_annotation.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:nyt_labels_update_story_tags]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/nyt_labels/update_story_tags.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:word2vec_generate_snapshot_model]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/word2vec/generate_snapshot_model.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:sitemap_fetch_media_pages]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/sitemap/fetch_media_pages.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:facebook_fetch_story_stats]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh mjm_worker.pl lib/MediaWords/Job/Facebook/FetchStoryStats.pm
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:extract_story_links]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/tm/extract_story_links_job.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:fetch_link]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/tm/fetch_link_job.py
directory = %(here)s/../
autorestart = false

autostart = true

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:fetch_twitter_urls]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./mediacloud/mediawords/job/tm/fetch_twitter_urls_job.py
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
numprocs = 1

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:solr_standalone]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./tools/solr/run/run_solr_standalone.py --jvm_heap_size 256m
directory = %(here)s/../
autorestart = true

autostart = false

stopasgroup = false
killasgroup = false
priority = 20
stopwaitsecs=100

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0




[program:solr_cluster_zookeeper]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./tools/solr/run/run_zookeeper.py --listen 0.0.0.0 --port 9983
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = true
killasgroup = true
priority = 20
numprocs = 1
stopwaitsecs=100
stopsignal=INT

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0


[group:solr_cluster]
programs=solr_shard



[program:solr_shard]
command = /usr/bin/nice -n 10 ./script/run_in_env.sh ./tools/solr/run/run_solr_shard.py --shard_index %(process_num)d --shard_count 2 --zookeeper_host localhost --zookeeper_port 9983 --jvm_heap_size 256m
directory = %(here)s/../
autorestart = false

autostart = false

stopasgroup = true
killasgroup = true
priority = 20
numprocs = 2
process_name = %(program_name)s_%(process_num)02d
stopwaitsecs=100
stopsignal=INT

; Write everything into a single log file
redirect_stderr = true

; Path to log file
stdout_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log
stderr_logfile = %(here)s/../data/supervisor_logs/%(program_name)s_%(process_num)02d.log

; Don't rotate logs (logrotate will do that)
stdout_logfile_maxbytes = 0
stderr_logfile_maxbytes = 0
stdout_logfile_backups = 0
stderr_logfile_backups = 0



; Include custom user's configuration
[include]
files = supervisord.user.*.conf

