ServerName  api.mediacloud.org
ServerAdmin mediacloud@cyber.law.harvard.edu

<Location />
    Options ExecCGI

    # New form to write "Order allow,deny; Allow from all" in Apache 2.4
    Require all granted

    AddHandler fcgid-script .pl
    AddHandler fcgid-script .sh
    AddHandler cgi-script   .cgi

    # Dynamic CORS header: https://stackoverflow.com/a/1850482/200603
    SetEnvIf Origin "http(s)?://.*?(media\.mit\.edu|mediacloud\.org)$" AccessControlAllowOrigin=$0
    Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
    Header merge Vary Origin

</Location>

# Static files served by the webapp
Alias           /static     /mediacloud_webapp_static
<Location /static>
    SetHandler default-handler
</Location>

FcgidMinProcessesPerClass  2
FcgidIdleTimeout           3600
FcgidProcessLifeTime       7200
FcgidConnectTimeout        8
FcgidIOTimeout             900
FcgidBusyTimeout           900
FcgidMaxRequestsPerProcess 1000
FcgidMaxRequestLen         8388608

Alias / /fastcgi.pl/

# Inline::Python work directory
FcgidInitialEnv PERL_INLINE_DIRECTORY /var/cache/Inline-webapp

FcgidInitialEnv HOME  /var/www/mediacloud
FcgidInitialEnv PATH  "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/X11R6/bin"
FcgidInitialEnv SHELL /bin/bash

LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\" %D" mc
CustomLog /var/log/apache2/access.log mc
